<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="https://i.stack.imgur.com/DgqBg.png?s=328&g=1" type="image/x-icon">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"
        integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA=="
        crossorigin="anonymous" />
    <title>Counter Claw</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, Helvetica, sans-serif;
            color: rgb(155, 102, 102);
        }

        *:focus {
            outline: none;
        }

        html,
        body {
            height: 100vh;
        }

        nav,
        footer {
            position: fixed;
            padding: 5vw;
            width: 100vw;
            z-index: 5;
        }

        nav>* {
            font-size: 1.5em;
        }

        .heading {
            padding-left: 0.5em;
        }

        .row1,
        #container,
        #dayBlock,
        #timeBlock,
        #day,
        #timeBlock>div,
        .row2 {
            display: flex;
            justify-content: center;
        }

        .row1 {
            height: 70vh;
            background: cornsilk;
            padding-bottom: 15vw;
            position: relative;
        }

        #container {
            width: 75vw;
            padding: 5vw 2.5vw;
            flex-direction: column;
            align-self: flex-end;
        }

        #dayBlock {
            margin-bottom: 7.5vw;
        }

        #day {
            width: 35vw;
            height: 35vw;
        }

        #timeBlock {
            justify-content: space-around;
        }

        #timeBlock>div {
            width: calc(75vw * 0.3);
            height: calc(75vw * 0.3);
        }

        #day,
        #timeBlock>div {
            border: 5px solid rgb(155, 102, 102);
            border-radius: 100%;
            flex-direction: column;
            align-items: center;
        }

        #day span:first-child {
            font-size: 2.75em;
        }

        #day span:last-child {
            font-size: 1.5em;
        }

        #timeBlock span:first-child {
            font-size: 1.25em;
            font-weight: 700;
        }

        #timeBlock span:last-child {
            font-size: 0.75em;
        }

        .row2 {
            height: calc(30vh - 50px);
        }

        .row1+.row2 {
            align-items: center;
        }

        .setTimer .row2 {
            height: 30vh;
            flex-direction: column;
        }

        button,
        #dateSetter,
        #timerMsg {
            background: transparent;
            border: 3px solid rgb(155, 102, 102);
            padding: 1vh;
            text-transform: capitalize;
            width: 75vw;
            font-size: 1.25em;
            margin: 0 auto;
            border-radius: 2em;
        }

        #dateSetter {
            text-transform: uppercase;
        }

        .btnActive,
        .row1+.row2 button:focus {
            background: rgb(155, 102, 102);
            color: #fff;
        }

        button:not(:first-child) {
            margin-top: 2vh;
        }

        .setTimer {
            z-index: 10;
            position: fixed;
            top: 0;
            display: flex;
            align-items: center;
            width: 100vw;
            height: 100vh;
            right: 100%;
            transition: all 0.75s ease;
            background: #fff;
        }

        .setTimer .row2 {
            width: 100vw;
        }

        .setTimer .fa-times {
            position: absolute;
            right: 5vw;
        }

        .setTimer nav:first-child {
            top: 0;
        }

        #timerMsg {
            border-radius: 5px;
            margin-top: 2vh;
            font-size: 1em;
            color: #000;
            text-transform: none;
        }

        footer {
            bottom: 0;
            padding: 5vw;
            text-align: center;
            z-index: 20;
        }

        #timerMessage {
            position: absolute;
            bottom: 2.5vw;
            padding: 2.5vw;
            display: none;
            width: 75vw;
            text-align: center;
            border: 1px solid rgb(155, 102, 102);
            ;
        }
    </style>
</head>

<body>

    <nav>
        <i class="fas fa-bars"></i>
        <span class="heading">Counter Claw</span>
    </nav>

    <div class="row1">
        <div id="container">
            <div id="dayBlock">
                <div id="day">
                    <span>0</span>
                    <span>days</span>
                </div>
            </div>
            <div id="timeBlock">
                <div id="hrs">
                    <span>0</span>
                    <span>hours</span>
                </div>
                <div id="min">
                    <span>0</span>
                    <span>minutes</span>
                </div>
                <div id="sec">
                    <span>0</span>
                    <span>seconds</span>
                </div>
            </div>
        </div>
        <div id="timerMessage"></div>
    </div>
    <div class="row2">
        <button>Set timer</button>
        <button>Discard</button>
    </div>

    <div class="setTimer">
        <nav>
            <span>Set timer</span>
            <i class="fas fa-times"></i>
        </nav>
        <div class="row2">
            <input type="date" id="dateSetter">
            <textarea id="timerMsg" rows="2" placeholder="Any short message?"></textarea>
            <button>Start</button>
        </div>
    </div>

    <footer>
        <span>Made with</span> <i class="fas fa-heart"></i> <span>by Pranav</span>
    </footer>

    <script>
        var interval;

        $(document).ready(() => {

            var present_cookies = getTimer();

            $("html, body").animate({ scrollTop: $(document).height() }, 0);
            
            var elem = document.querySelector('body');
            if (elem.requestFullscreen) {
              elem.requestFullscreen();
            } else if (elem.msRequestFullscreen) {
              elem.msRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
              elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) {
              elem.webkitRequestFullscreen();
            }

            if (present_cookies.length) {
                let timer = present_cookies.filter((el) => {
                    return (!el.indexOf('timer'));
                })[0];

                let ind = present_cookies.indexOf(timer);
                present_cookies.splice(ind, ind + 1);

                let curDate = new Date();
                let tempDate = new Date(timer.split("=")[1]);
                let dateDiff = (tempDate - curDate) / 1000;

                diffTime(dateDiff);

                if (present_cookies.length) {
                    let msgVal = present_cookies[0].split('=')[1];
                    if (msgVal) {
                        $('#timerMessage').show();
                        $('#timerMessage').text(msgVal);
                    }
                }


                $('.row1 + .row2 button:first-child').hide().siblings().css("margin-top", 0);
            }
            else {
                $('.row1 + .row2 button:last-child').hide();
                $('#timerMessage').hide();
            }



            $('.row2 button:first-child').click(() => {
                $('.setTimer').css("right", 0);
            })

            $('.setTimer .fa-times').click(() => {
                $('.setTimer').css("right", "100%");
            })

            $('.row1 + .row2 button:last-child').click(function () {
                document.cookie = "timer=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                document.cookie = "msg=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                clearInterval(interval);
                reset();
                $(this).hide().siblings().show();
                $('#timerMessage').hide();
            })

            $('#dateSetter').on('change', function () {
                let $btn = $(this).siblings('button');
                let tempDate = new Date();
                let dateVal = $(this).val();

                let typedDate = new Date(dateVal);

                ((typedDate - tempDate) > 0) ? $btn.addClass('btnActive') : $btn.removeClass('btnActive');
            })

            $('#timerMsg + button').click(function () {
                if ($(this).hasClass('btnActive')) {
                    let dateVal = $('#dateSetter').val();
                    let typedDate = new Date(dateVal);
                    let dupTypedDate = new Date(typedDate);
                    let msgVal = $('#timerMsg').val().trim();

                    typedDate.setTime(typedDate.getTime() + (90 * 24 * 60 * 60 * 1000));
                    let expires = "expires=" + typedDate.toUTCString();

                    document.cookie = "timer=" + dupTypedDate + ";" + expires + ";path=/";

                    if (msgVal) {
                        $('#timerMessage').show();
                        $('#timerMessage').text(msgVal);
                        document.cookie = "msg=" + msgVal + ";" + expires + ";path=/";
                    }

                    $('.setTimer .fa-times').click();

                    let temp = getTimer();

                    let tempDate = new Date();
                    let dateDiff = (dupTypedDate - tempDate) / 1000;
                    diffTime(dateDiff);



                    $('#timerMsg, #dateSetter').val("");
                    $('#timerMsg + .btnActive').removeClass('btnActive');

                    $('.row1 + .row2 button:first-child').hide().siblings().show();
                }
            })
        })

        function getTimer() {
            let timer = "timer=";
            let decodedCookie = decodeURIComponent(document.cookie);
            let cookiesAll = decodedCookie.split(';');

            let cookieArr = cookiesAll.filter((el) => {
                el = el.trim();
                return (!(el.indexOf('timer')) || !(el.indexOf('msg')));
            }).map((el) => {
                return el.trim();
            })

            return cookieArr;
        }

        function setTime(dateDiff) {
            let days = Math.floor(dateDiff / 86400);
            dateDiff -= days * 86400;

            let hours = Math.floor(dateDiff / 3600) % 24;
            dateDiff -= hours * 3600;

            let minutes = Math.floor(dateDiff / 60) % 60;
            dateDiff -= minutes * 60;

            let seconds = Math.floor(dateDiff % 60);

            $('#day span:first-child').text(days);
            $('#hrs span:first-child').text(hours);
            $('#min span:first-child').text(minutes);
            $('#sec span:first-child').text(seconds);
        }

        function reset() {
            $('#day, #hrs, #min, #sec').find('span:first-child').text(0);
        }

        function diffTime(dateDiff) {
            setTime(dateDiff);

            interval = setInterval(function () {
                setTime(--dateDiff);
            }, 1000);
        }
    </script>

</body>

</html>
